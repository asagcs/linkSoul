{"version":3,"sources":["uni-app:///main.js","webpack:///E:/HbuilderX/新建文件夹/linkSoul/pages/component/mqtt.vue?1a4e","webpack:///E:/HbuilderX/新建文件夹/linkSoul/pages/component/mqtt.vue?c3ff","webpack:///E:/HbuilderX/新建文件夹/linkSoul/pages/component/mqtt.vue?b6a8","webpack:///E:/HbuilderX/新建文件夹/linkSoul/pages/component/mqtt.vue?b83e","uni-app:///pages/component/mqtt.vue","webpack:///E:/HbuilderX/新建文件夹/linkSoul/pages/component/mqtt.vue?02f5","webpack:///E:/HbuilderX/新建文件夹/linkSoul/pages/component/mqtt.vue?4629"],"names":["createPage","Page"],"mappings":";;;;;;;;;;kDAAA;AACA;AACA,8F;AACAA,UAAU,CAACC,aAAD,CAAV,C;;;;;;;;;;;;;ACHA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAiH;AACjH;AACwD;AACL;AACa;;;AAGhE;AACmK;AACnK,gBAAgB,6KAAU;AAC1B,EAAE,0EAAM;AACR,EAAE,+EAAM;AACR,EAAE,wFAAe;AACjB;AACA;AACA;AACA;AACA;AACA,EAAE,mFAAU;AACZ;AACA;;AAEA;AACe,gF;;;;;;;;;;;;ACvBf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;ACRA;AAAA;AAAA;AAAA;AAAimB,CAAgB,8mBAAG,EAAC,C;;;;;;;;;;;;;;;;;;;;ACQrnB;AACA;AACA,qE;;AAEA;AACA,MADA,kBACA;AACA;AACA;AACA,sCADA;AAEA,yBAFA;AAGA,qBAHA,EADA;;AAMA,0BANA;AAOA,YAPA;AAQA,iCARA;AASA,aATA;AAUA,wBAVA;AAWA,kBAXA;AAYA;AACA;AACA,qBADA;AAEA,0BAFA,EAEA;AACA,wCAHA;AAIA,qBAJA;AAKA,oBALA;AAMA,oBANA;AAOA,oBAPA;AAQA,6BARA,EAQA;AACA,iCATA,EASA;AACA,yBAVA,CAUA;AAVA,OAbA;;AA0BA,GA5BA;AA6BA;AACA,gDADA;AAEA,6CAFA;AAGA,iDAHA;;AAKA;AACA;;;;;AAKA,0DALA;;;;;;AAWA;AACA;AACA,yBADA;;AAGA;AACA;AACA;AACA,aADA;AAEA,oBAFA;;;AAKA;;AAEA;AACA;AACA;AACA;AACA;AACA,SALA;;;AAQA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,+CADA;AAEA,mCAFA;AAGA,8BAHA;;AAKA,WANA,MAMA;AACA;AACA,2CADA;AAEA,mCAFA;AAGA,8BAHA;;AAKA;AACA;;AAEA;AACA;AACA,SAtBA;;AAwBA;;AAEA;AACA;AACA;;AAEA,OAJA;AAKA;AACA;AACA;AACA;AACA,OAJA;;AAMA,KA3EA;AA4EA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBADA;AAEA;AACA;AACA;AACA;AACA;AACA,OAPA;;AASA;;;;;;;;;;;;;;;;;;;;AAoBA,KAhHA;;AAkHA;AACA;AACA;AACA;AACA,kBAHA;AAIA;AACA;AACA;AACA,OAPA;;AASA,KA5HA;AA6HA;AACA;AACA;AACA;AACA;AACA,KAlIA;AAmIA;AACA;AACA,oBADA;AAEA,kBAFA;;AAIA;AACA;AACA,OAFA,EAEA,IAFA;AAGA,KA3IA;AA4IA,WA5IA,qBA4IA;AACA;AACA;AACA;AACA;AACA,KAjJA,GA7BA;;AAgLA,SAhLA,qBAgLA;AACA;AACA;AACA;AACA;AACA,wBADA;AAEA;AACA;AACA,OAJA;;;AAOA;AACA;AACA;AACA,0BADA;AAEA,uBAFA;;AAIA,KANA,MAMA;AACA;AACA;AACA;AACA;AACA,GAtMA,E;;;;;;;;;;;;;ACZA;AAAA;AAAA;AAAA;AAAo3B,CAAgB,m2BAAG,EAAC,C;;;;;;;;;;;ACAx4B;AACA,OAAO,KAAU,EAAE,kBAKd","file":"pages/component/mqtt.js","sourcesContent":["import 'uni-pages';\nimport Vue from 'vue'\nimport Page from './pages/component/mqtt.vue'\ncreatePage(Page)","import { render, staticRenderFns, recyclableRender, components } from \"./mqtt.vue?vue&type=template&id=423ca2af&\"\nvar renderjs\nimport script from \"./mqtt.vue?vue&type=script&lang=js&\"\nexport * from \"./mqtt.vue?vue&type=script&lang=js&\"\nimport style0 from \"./mqtt.vue?vue&type=style&index=0&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"pages/component/mqtt.vue\"\nexport default component.exports","export * from \"-!../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--16-0!../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./mqtt.vue?vue&type=template&id=423ca2af&\"","var components\nvar render = function() {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../../HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./mqtt.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./mqtt.vue?vue&type=script&lang=js&\"","<template>\r\n\t<view>\r\n\t\t\r\n\t</view>\r\n</template>\r\n\r\n<script>\r\n\t//import mqtt from '../../utils/mqtt.js';//二选一\r\n\timport mqtt from '../../utils/mqtt.min.js';\r\n\timport { mapMutations, mapState } from \"vuex\";\r\n\timport Vue from 'vue';\r\n\t\r\n\texport default {\r\n\t\tdata() {\r\n\t\t\treturn {\r\n\t\t\t\tserve: {\r\n\t\t\t\t\thost: 'redumqtt.zkhuashui.com',\r\n\t\t\t\t\tport: Number(443),\r\n\t\t\t\t\tpath: '/mqtt',\r\n\t\t\t\t},\r\n\t\t\t\tonTopic: 'testtopic',\r\n\t\t\t\tQos: 0,\r\n\t\t\t\tsendMassage: 'Hello EMQ-X！',\r\n\t\t\t\ttime:0,\r\n\t\t\t\treceiveMessage: '',\r\n\t\t\t\tclient: null,\r\n\t\t\t\t//MQTT连接的配置\r\n\t\t\t\toptions: {\r\n\t\t\t\t\twsOptions: {},\r\n\t\t\t\t\tprotocolVersion: 4, //MQTT连接协议版本\r\n\t\t\t\t\tclientId: 'web_' + this.clientId,\r\n\t\t\t\t\tkeepalive: 60,\r\n\t\t\t\t\tclean: false,\r\n\t\t\t\t\tusername: '',\r\n\t\t\t\t\tpassword: '',\r\n\t\t\t\t\treconnectPeriod: 1000, //1000毫秒，两次重新连接之间的间隔\r\n\t\t\t\t\tconnectTimeout: 30 * 1000, //1000毫秒，两次重新连接之间的间隔\r\n\t\t\t\t\tresubscribe: true //如果连接断开并重新连接，则会再次自动订阅已订阅的主题（默认true）\r\n\t\t\t\t},\r\n\t\t\t};\r\n\t\t},\r\n\t\tmethods: {\r\n\t\t\t...mapMutations([\"catchSocketAction\"]),\n            ...mapMutations([\"connectSuccess\"]),\r\n\t\t\t...mapMutations([\"setChatTextHistory\"]),\r\n\t\t\t\r\n\t\t\tconnect: function() {\r\n\t\t\t\tvar hosts = '',\r\n\t\t\t\t\t// #ifdef H5\r\n\t\t\t\t\thosts = 'ws://' + this.serve.host + ':' + this.serve.port + this.serve.path\r\n\t\t\t\t//#endif\r\n\t\t\t\t// #ifdef MP-WEIXIN \r\n\t\t\t\thosts = 'wxs://' + this.serve.host + this.serve.path\r\n\t\t\t\t//#endif\r\n\t\t\t\t// #ifdef APP-PLUS\r\n\t\t\t\thosts = 'wx://' + this.serve.host + ':' + this.serve.port + this.serve.path\r\n\t\t\t\t//#endif\r\n\r\n\t\t\t\tif (this.client == null || this.client.connented == false) {\r\n\t\t\t\t\tuni.showLoading({\r\n\t\t\t\t\t\ttitle: '连接中···'\r\n\t\t\t\t\t})\r\n\t\t\t\t\tthis.connectSuccess(false)\r\n\t\t\t\t\t// console.log(hosts, this.options)\r\n\t\t\t\t\tthis.client = mqtt.connect(\r\n\t\t\t\t\t\thosts,\r\n\t\t\t\t\t\tthis.options\r\n\t\t\t\t\t);\r\n\t\t\t\t\t\r\n\t\t\t\t\tVue.prototype.$mqttClient = this.client;\r\n\r\n\t\t\t\t\tthis.client.on('connect', () => {\r\n\t\t\t\t\t\tuni.hideLoading();\r\n\t\t\t\t\t\tthis.showToast('连接成功', 1000, 'success');\r\n\t\t\t\t\t\tthis.connectSuccess(true)\r\n\t\t\t\t\t\tthis.subscribe();\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\r\n\t\t\t\t\tthis.client.on('message', (topic, message) => {\r\n\t\t\t\t\t\t//console.log('收到来自' + topic + '的消息' );\r\n\t\t\t\t\t\tlet newData = JSON.parse(message);\r\n\t\t\t\t\t\t// console.log(newData)\r\n\t\t\t\t\t\tlet newMessage;\r\n\t\t\t\t\t\tif(topic === (\"chat/\" + this.$store.state.userInfo.id)){\r\n\t\t\t\t\t\t\tnewMessage = {\r\n\t\t\t\t\t\t\t\tid: \"chatId\" + newData.customerId,\r\n\t\t\t\t\t\t\t\tchatTextList: newData,\r\n\t\t\t\t\t\t\t\tfetchData: false,\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\tnewMessage = {\r\n\t\t\t\t\t\t\t\tid: topic.replace(/\\//, 'Id'),\r\n\t\t\t\t\t\t\t\tchatTextList: newData,\r\n\t\t\t\t\t\t\t\tfetchData: false,\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tthis.receiveMessage = message;\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t//console.log(newMessage)\r\n\t\t\t\t\t\tthis.setChatTextHistory(newMessage)\r\n\t\t\t\t\t});\r\n\t\t\t\t\t\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.client.on('reconnect', error => {\r\n\t\t\t\t\tuni.hideLoading();\r\n\t\t\t\t\tthis.showToast('正在重连···', 1000)\r\n\r\n\t\t\t\t});\r\n\t\t\t\tthis.client.on('error', error => {\r\n\t\t\t\t\tuni.hideLoading();\r\n\t\t\t\t\tthis.showToast('连接失败!', 1000)\r\n\t\t\t\t\tthis.connect();\r\n\t\t\t\t});\r\n\r\n\t\t\t},\r\n\t\t\tsubscribe: function() {\r\n\t\t\t\t// 判断是否已成功连接\r\n\t\t\t\tif (!this.client || !this.client.connected) {\r\n\t\t\t\t\tthis.showToast('客户端未连接', 1000)\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tlet userId = this.$store.state.userId;\r\n\t\t\t\tthis.client.subscribe(\"chat/\" + userId, {\r\n\t\t\t\t\tqos: this.Qos\r\n\t\t\t\t}, error => {\r\n\t\t\t\t\tif (!error) {\r\n\t\t\t\t\t\t//this.showToast('订阅成功', 1000, 'success')\r\n\t\t\t\t\t\tconsole.log('订阅成功');\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\t/* //订阅多个主题\r\n\t\t\tthis.client.subscribe(['one', 'two', 'three'], { qos: 1 }, err => {\r\n\t\t\t\tconsole.log(err || '订阅成功');\r\n\t\t\t\tthis.show(err || '订阅成功');\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\t\t    // 订阅不同 qos 的不同主题\r\n\t\t\t\t    this.client.subscribe(\r\n\t\t\t\t        [\r\n\t\t\t\t            { hello: 1 },\r\n\t\t\t\t            { 'one/two/three': 2 },\r\n\t\t\t\t            { '#': 0 }\r\n\t\t\t\t        ],\r\n\t\t\t\t        (err) => {\r\n\t\t\t\t          this.show();console.log(err || '订阅成功')\r\n\t\t\t\t        },\r\n\t\t\t\t    )\r\n\t\t\r\n\t\t\r\n\t\t\t}); */\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\tunsubscribe: function() {\r\n\t\t\t\tthis.client.unsubscribe(\r\n\t\t\t\t\t// topic, topic Array, topic Array-Onject\r\n\t\t\t\t\t// ['one', 'two', 'three'],\r\n\t\t\t\t\tthis.onTopic,\r\n\t\t\t\t\terr => {\r\n\t\t\t\t\t\tconsole.log(err || '取消订阅成功');\r\n\t\t\t\t\t\tthis.showToast('取消订阅成功', 1000, 'success')\r\n\t\t\t\t\t}\r\n\t\t\t\t);\r\n\t\t\t},\r\n\t\t\tunconnect: function() {\r\n\t\t\t\tthis.client.end();\r\n\t\t\t\tthis.client = null\r\n\t\t\t\tthis.showToast('成功断开连接', 1000, 'success')\r\n\t\t\t\tconsole.log('断开连接');\r\n\t\t\t},\r\n\t\t\tshowToast: function(title, time, icon = 'none') {\r\n\t\t\t\tuni.showToast({\r\n\t\t\t\t\ttitle: title,\r\n\t\t\t\t\ticon: icon,\r\n\t\t\t\t});\r\n\t\t\t\tsetTimeout(function() {\r\n\t\t\t\t\tuni.hideToast();\r\n\t\t\t\t}, time);\r\n\t\t\t},\r\n\t\t\tgetUUID(){\r\n\t\t\t    function S4() {\r\n\t\t\t        return (((1+Math.random())*0x10000)|0).toString(16).substring(1);\r\n\t\t\t    }\r\n\t\t\t    return (S4()+S4()+\"-\"+S4()+\"-\"+S4()+\"-\"+S4()+\"-\"+S4()+S4()+S4());\r\n\t\t\t}\r\n\t\t},\r\n\t\tcreated() {\r\n\t\t\tconsole.log(444)\r\n\t\t\t// 获取id，无，生成id\r\n\t\t\tlet clientId;\r\n\t\t\tuni.getStorage({\r\n\t\t\t\tkey: 'ep_clientId',\r\n\t\t\t\tsuccess: function (res) {\n\t\t\t\t\tclientId = res.data;\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\t\r\n\t\t\tif(!clientId){\r\n\t\t\t\tlet clientId = this.getUUID();\r\n\t\t\t\tuni.setStorage({\r\n\t\t\t\t\tkey: 'ep_clientId',\r\n\t\t\t\t\tdata: clientId  \r\n\t\t\t\t});\r\n\t\t\t}else{\r\n\t\t\t\tthis.clientId = clientId;\r\n\t\t\t}\r\n\t\t\t// 初始化\r\n\t\t\tthis.connect()\r\n\t\t}\r\n\t}\r\n</script>\r\n<style>\r\n\tbutton {\r\n\t\tmargin-top: 30upx;\r\n\t\tmargin-bottom: 30upx;\r\n\t}\r\n</style>\n","import mod from \"-!../../../../HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--6-oneOf-1-2!../../../../HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-3!../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./mqtt.vue?vue&type=style&index=0&lang=css&\"; export default mod; export * from \"-!../../../../HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--6-oneOf-1-2!../../../../HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-3!../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./mqtt.vue?vue&type=style&index=0&lang=css&\"","// extracted by mini-css-extract-plugin\n    if(module.hot) {\n      // 1597827130209\n      var cssReload = require(\"E:/HbuilderX/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/hmr/hotModuleReplacement.js\")(module.id, {\"hmr\":true,\"publicPath\":\"../../\",\"locals\":false});\n      module.hot.dispose(cssReload);\n      module.hot.accept(undefined, cssReload);\n    }\n  "],"sourceRoot":""}